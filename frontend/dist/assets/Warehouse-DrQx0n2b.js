const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/quagga.min-CQxS43Jy.js","assets/index-TnPH2S_w.js","assets/index-B9zXfgxB.css"])))=>i.map(i=>d[i]);
import{r as t,u as X,b as Y,j as e,_ as D}from"./index-TnPH2S_w.js";function ee({title:n,titleId:r,...i},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),n?t.createElement("title",{id:r},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"}))}const W=t.forwardRef(ee);function te({title:n,titleId:r,...i},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),n?t.createElement("title",{id:r},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"}))}const Q=t.forwardRef(te);function re({title:n,titleId:r,...i},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),n?t.createElement("title",{id:r},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const Z=t.forwardRef(re);function ae({title:n,titleId:r,...i},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),n?t.createElement("title",{id:r},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"}))}const ne=t.forwardRef(ae);function se({title:n,titleId:r,...i},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),n?t.createElement("title",{id:r},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"}))}const H=t.forwardRef(se);function oe({title:n,titleId:r,...i},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),n?t.createElement("title",{id:r},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))}const K=t.forwardRef(oe);function le({title:n,titleId:r,...i},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),n?t.createElement("title",{id:r},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const ie=t.forwardRef(le);function ce({title:n,titleId:r,...i},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),n?t.createElement("title",{id:r},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"}))}const G=t.forwardRef(ce);function de({title:n,titleId:r,...i},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),n?t.createElement("title",{id:r},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))}const ue=t.forwardRef(de);function me({title:n,titleId:r,...i},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),n?t.createElement("title",{id:r},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const J=t.forwardRef(me);function xe({title:n,titleId:r,...i},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),n?t.createElement("title",{id:r},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const he=t.forwardRef(xe);function ge({title:n,titleId:r,...i},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),n?t.createElement("title",{id:r},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const q=t.forwardRef(ge);function fe({onScan:n,onClose:r}){const[i,o]=t.useState(!1),[x,y]=t.useState(null),[j,a]=t.useState(""),[w,S]=t.useState(!1),[k,E]=t.useState(!1),[d,p]=t.useState(!1),[L,R]=t.useState(""),B=t.useRef(null);t.useRef(null),t.useRef(null);const M=t.useRef({});t.useEffect(()=>{let m=!0;return(async()=>{try{const c=(await D(async()=>{const{default:u}=await import("./quagga.min-CQxS43Jy.js").then(b=>b.q);return{default:u}},__vite__mapDeps([0,1,2]))).default;if(!m)return;c.init({inputStream:{name:"Live",type:"LiveStream",target:B.current,constraints:{facingMode:"environment",width:{min:640,ideal:1280,max:1920},height:{min:480,ideal:720,max:1080}}},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:navigator.hardwareConcurrency||4,frequency:10,decoder:{readers:["ean_reader","ean_8_reader","upc_reader","upc_e_reader","code_128_reader","code_39_reader","i2of5_reader"],multiple:!1},locate:!0},u=>{if(u){console.error("Quagga init error:",u),m&&y("Kamera konnte nicht gestartet werden");return}c.start(),m&&o(!0)}),c.onDetected(u=>{const b=u.codeResult.code;b&&(M.current[b]=(M.current[b]||0)+1,M.current[b]>=3&&(console.log("âœ… Barcode erkannt:",b),navigator.vibrate&&navigator.vibrate([100,50,100]),c.stop(),n(b)))})}catch(c){console.error("Scanner error:",c),m&&y("Kamera nicht verfÃ¼gbar. Nutze Foto oder manuelle Eingabe.")}})(),()=>{m=!1,D(async()=>{const{default:c}=await import("./quagga.min-CQxS43Jy.js").then(u=>u.q);return{default:c}},__vite__mapDeps([0,1,2])).then(({default:c})=>{c.stop()}).catch(()=>{})}},[n]);const h=async()=>{var m;try{const c=(await D(async()=>{const{default:u}=await import("./quagga.min-CQxS43Jy.js").then(b=>b.q);return{default:u}},__vite__mapDeps([0,1,2]))).default.CameraAccess.getActiveTrack();if(c){const u=(m=c.getCapabilities)==null?void 0:m.call(c);u!=null&&u.torch?(await c.applyConstraints({advanced:[{torch:!k}]}),E(!k)):alert("Taschenlampe nicht verfÃ¼gbar auf diesem GerÃ¤t")}}catch(l){console.log("Torch error:",l)}},g=m=>new Promise((l,c)=>{const u=new FileReader;u.readAsDataURL(m),u.onload=()=>l(u.result),u.onerror=c}),P=async()=>{var m;if(i){p(!0),R("ðŸ“¸ Bild wird aufgenommen...");try{const l=(await D(async()=>{const{default:f}=await import("./quagga.min-CQxS43Jy.js").then(O=>O.q);return{default:f}},__vite__mapDeps([0,1,2]))).default;if(!l.CameraAccess.getActiveTrack()){alert("Kamera nicht verfÃ¼gbar"),p(!1);return}const u=document.querySelector("#scanner-container video");if(!u){alert("Video nicht gefunden"),p(!1);return}const b=document.createElement("canvas");b.width=u.videoWidth||1280,b.height=u.videoHeight||720,b.getContext("2d").drawImage(u,0,0);const A=b.toDataURL("image/jpeg",.9);console.log("Captured frame, size:",Math.round(A.length/1024),"KB"),R("ðŸ” Analysiere Barcode...");const F=await(await fetch(A)).blob(),T=new File([F],"capture.jpg",{type:"image/jpeg"}),$=URL.createObjectURL(T),C=await new Promise(f=>{l.decodeSingle({src:$,numOfWorkers:0,decoder:{readers:["ean_reader","ean_8_reader","upc_reader","upc_e_reader","code_128_reader"]},locate:!0,locator:{patchSize:"large",halfSample:!1}},f)});if(URL.revokeObjectURL($),(m=C==null?void 0:C.codeResult)!=null&&m.code){console.log("âœ… Quagga found:",C.codeResult.code),navigator.vibrate&&navigator.vibrate([100,50,100]),l.stop(),p(!1),n(C.codeResult.code);return}R("ðŸ¤– AI analysiert Bild...");const s=await N(T);if(s){console.log("âœ… AI found:",s),navigator.vibrate&&navigator.vibrate([100,50,100]),l.stop(),p(!1),n(s);return}p(!1),alert(`Barcode nicht erkannt.

Tipps:
â€¢ Halte das Produkt nÃ¤her
â€¢ Bessere Beleuchtung
â€¢ Barcode gerade halten`)}catch(l){console.error("Capture error:",l),p(!1),alert("Fehler beim Scannen")}}},N=async m=>{R("ðŸ¤– AI analysiert Bild...");try{const l=await g(m),u=await(await fetch("/api/ai/scan-barcode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:l})})).json();return u.barcode?u.barcode:null}catch(l){return console.error("AI scan error:",l),null}},z=async m=>{var c,u;const l=(c=m.target.files)==null?void 0:c[0];if(l){p(!0),R("ðŸ“· Scanne Barcode...");try{const b=(await D(async()=>{const{default:T}=await import("./quagga.min-CQxS43Jy.js").then($=>$.q);return{default:T}},__vite__mapDeps([0,1,2]))).default,I=URL.createObjectURL(l),A=await new Promise(T=>{b.decodeSingle({src:I,numOfWorkers:0,decoder:{readers:["ean_reader","ean_8_reader","upc_reader","upc_e_reader","code_128_reader","code_39_reader"]},locate:!0,locator:{patchSize:"large",halfSample:!1}},T)});if(URL.revokeObjectURL(I),(u=A==null?void 0:A.codeResult)!=null&&u.code){console.log("âœ… Quagga erkannt:",A.codeResult.code),navigator.vibrate&&navigator.vibrate([100,50,100]),b.stop(),p(!1),n(A.codeResult.code);return}console.log("Quagga fehlgeschlagen, versuche AI...");const F=await N(l);if(F){console.log("âœ… AI erkannt:",F),navigator.vibrate&&navigator.vibrate([100,50,100]),b.stop(),p(!1),n(F);return}p(!1),alert(`Barcode nicht erkannt.

Tipps:
â€¢ Besseres Licht
â€¢ Barcode grÃ¶ÃŸer im Bild
â€¢ SchÃ¤rferes Foto

Oder manuell eingeben.`)}catch(b){console.error("Photo scan error:",b),p(!1),alert("Fehler beim Scannen.")}}},_=async()=>{if(j.trim()){try{(await D(async()=>{const{default:l}=await import("./quagga.min-CQxS43Jy.js").then(c=>c.q);return{default:l}},__vite__mapDeps([0,1,2]))).default.stop()}catch{}n(j.trim())}},v=async()=>{try{(await D(async()=>{const{default:l}=await import("./quagga.min-CQxS43Jy.js").then(c=>c.q);return{default:l}},__vite__mapDeps([0,1,2]))).default.stop()}catch{}r()};return e.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[e.jsxs("div",{className:"bg-black p-4 flex items-center justify-between z-20",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-xl",children:"Barcode scannen"}),e.jsx("p",{className:"text-white/70 text-sm",children:d?L||"â³ Wird gescannt...":i?"ðŸ“· Barcode vor die Kamera halten":x?"âš ï¸ "+x:"â³ Kamera startet..."})]}),e.jsx("button",{onClick:v,className:"p-3 bg-white/20 rounded-full",children:e.jsx(q,{className:"w-6 h-6 text-white"})})]}),e.jsxs("div",{className:"flex-1 relative bg-black overflow-hidden",children:[e.jsx("div",{ref:B,id:"scanner-container",className:"absolute inset-0",style:{width:"100%",height:"100%"}}),e.jsxs("div",{className:"absolute inset-0 pointer-events-none z-10",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40"}),e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-72 h-36 bg-transparent border-0",children:[e.jsx("div",{className:"absolute inset-0",style:{boxShadow:"0 0 0 9999px rgba(0,0,0,0.5)"}}),e.jsx("div",{className:"absolute -top-1 -left-1 w-8 h-8 border-t-4 border-l-4 border-rose-500 rounded-tl"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-8 h-8 border-t-4 border-r-4 border-rose-500 rounded-tr"}),e.jsx("div",{className:"absolute -bottom-1 -left-1 w-8 h-8 border-b-4 border-l-4 border-rose-500 rounded-bl"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 border-b-4 border-r-4 border-rose-500 rounded-br"}),i&&e.jsx("div",{className:"absolute left-2 right-2 h-0.5 bg-rose-500",style:{animation:"scanline 2s ease-in-out infinite",boxShadow:"0 0 8px rgba(244,63,94,0.8)"}})]})]}),e.jsx("button",{onClick:h,className:`absolute top-4 right-4 z-20 p-4 rounded-full shadow-lg pointer-events-auto ${k?"bg-yellow-400 text-black":"bg-white/90 text-gray-800"}`,children:"ðŸ”¦"}),e.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center z-20",children:e.jsx("p",{className:"text-white/80 text-sm",children:"Halte den Barcode ruhig in den Rahmen"})})]}),e.jsxs("div",{className:"bg-black p-4 space-y-3 z-20",children:[w&&e.jsxs("div",{className:"bg-white rounded-2xl p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2 font-medium",children:"Barcode manuell eingeben:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",inputMode:"numeric",value:j,onChange:m=>a(m.target.value.replace(/[^0-9]/g,"")),onKeyDown:m=>m.key==="Enter"&&_(),placeholder:"z.B. 4000417025005",className:"flex-1 p-3 border-2 rounded-xl text-lg font-mono focus:border-rose-500 focus:outline-none",autoFocus:!0}),e.jsx("button",{onClick:_,disabled:!j.trim(),className:"px-5 py-3 bg-rose-500 text-white rounded-xl font-bold disabled:opacity-50",children:"OK"})]})]}),i&&!w&&e.jsx("button",{onClick:P,disabled:d,className:`w-full py-4 mb-3 rounded-xl font-bold text-lg flex items-center justify-center gap-2 ${d?"bg-gray-500":"bg-green-500 active:bg-green-600"} text-white`,children:d?L:"ðŸŽ¯ JETZT SCANNEN"}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:v,className:"px-4 py-3 bg-gray-700 text-white rounded-full text-sm",children:"âœ•"}),e.jsxs("label",{className:`px-4 py-3 bg-blue-500 text-white rounded-full text-sm font-medium cursor-pointer ${d?"opacity-50":""}`,children:[d?"â³":"ðŸ“¸ Foto",e.jsx("input",{type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:z,disabled:d})]}),e.jsx("button",{onClick:()=>S(!w),className:"px-4 py-3 bg-rose-500 text-white rounded-full text-sm font-medium",children:w?"ðŸ“·":"âŒ¨ï¸"})]})]}),e.jsx("style",{children:`
        @keyframes scanline {
          0%, 100% { top: 10%; }
          50% { top: 85%; }
        }
        #scannerRef video {
          width: 100% !important;
          height: 100% !important;
          object-fit: cover !important;
        }
      `})]})}function be({barcode:n,existingProduct:r,onConfirm:i,onCancel:o,onManualAdd:x}){const[y,j]=t.useState(!r),[a,w]=t.useState(r||null),[S,k]=t.useState(1),[E,d]=t.useState(!1),[p,L]=t.useState(!1);t.useEffect(()=>{r||R(n)},[n,r]);const R=async h=>{var g,P,N,z,_;j(!0),d(!1);try{const m=await(await fetch(`https://world.openfoodfacts.org/api/v2/product/${h}.json?fields=product_name,product_name_de,brands,image_front_url,image_url,categories_tags,quantity,serving_size,nutriments,ingredients_text_de,ingredients_text,nutriscore_grade,ecoscore_grade,nova_group,packaging,origins,countries,stores`)).json();if(m.status===1&&m.product){const l=m.product,c=l.nutriments||{};w({name:l.product_name_de||l.product_name||"Unbekanntes Produkt",brand:l.brands||"",image:l.image_front_url||l.image_url||null,category:M((g=l.categories_tags)==null?void 0:g[0])||"Sonstiges",barcode:h,source:"Open Food Facts",quantity_info:l.quantity||"",serving_size:l.serving_size||"",ingredients:l.ingredients_text_de||l.ingredients_text||"",packaging:l.packaging||"",origin:l.origins||"",nutrition:{energy_kcal:c["energy-kcal_100g"],fat:c.fat_100g,saturated_fat:c["saturated-fat_100g"],carbs:c.carbohydrates_100g,sugar:c.sugars_100g,protein:c.proteins_100g,salt:c.salt_100g,fiber:c.fiber_100g},nutriscore:(P=l.nutriscore_grade)==null?void 0:P.toUpperCase(),ecoscore:(N=l.ecoscore_grade)==null?void 0:N.toUpperCase(),nova:l.nova_group}),j(!1);return}try{const c=await(await fetch(`https://api.upcitemdb.com/prod/trial/lookup?upc=${h}`)).json();if(((z=c.items)==null?void 0:z.length)>0){const u=c.items[0];w({name:u.title||"Unbekanntes Produkt",brand:u.brand||"",image:((_=u.images)==null?void 0:_[0])||null,category:"Sonstiges",barcode:h,source:"UPC Database",description:u.description||""}),j(!1);return}}catch{console.log("UPC lookup failed")}console.log("Product not found in any database, barcode:",h),w({name:"",brand:"",image:null,category:"Sonstiges",barcode:h,source:"Nicht gefunden",needsManualEntry:!0}),d(!0)}catch(v){console.error("Lookup error:",v),d(!0)}j(!1)},B=async()=>{j(!0);try{const h=document.createElement("input");h.type="file",h.accept="image/*",h.capture="environment",h.onchange=async g=>{var z;const P=(z=g.target.files)==null?void 0:z[0];if(!P){j(!1);return}const N=new FileReader;N.onload=async()=>{try{const v=await(await fetch("/api/ai/identify-product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:N.result,barcode:n})})).json();v.product?(w({name:v.product.name||"Unbekanntes Produkt",brand:v.product.brand||"",image:null,category:v.product.category||"Sonstiges",barcode:n,source:"ðŸ¤– AI erkannt",description:v.product.description||"",quantity_info:v.product.quantity_info||"",price:v.product.estimated_price||null}),d(!1)):alert(`AI konnte das Produkt nicht identifizieren.
Bitte manuell eingeben.`)}catch(_){console.error("AI identify error:",_),alert("Fehler bei der AI-Erkennung")}j(!1)},N.readAsDataURL(P)},h.click()}catch{j(!1)}},M=h=>{if(!h)return"Sonstiges";const g=h.toLowerCase();return g.includes("beverage")||g.includes("drink")||g.includes("getrÃ¤nk")?"GetrÃ¤nke":g.includes("snack")||g.includes("chips")?"Snacks":g.includes("sweet")||g.includes("chocolate")||g.includes("sÃ¼ÃŸ")?"SÃ¼ÃŸigkeiten":g.includes("dairy")||g.includes("milk")||g.includes("milch")?"Milchprodukte":g.includes("frozen")||g.includes("tiefkÃ¼hl")?"TiefkÃ¼hl":"Sonstiges"};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 flex items-end sm:items-center justify-center",children:e.jsxs("div",{className:"bg-white w-full sm:w-96 sm:rounded-2xl rounded-t-3xl max-h-[90vh] overflow-y-auto animate-slide-up",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-4 py-3 flex items-center justify-between rounded-t-3xl",children:[e.jsx("h3",{className:"font-bold text-lg",children:r?"Bestand auffÃ¼llen":"Produkt hinzufÃ¼gen"}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(q,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-4",children:y?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(W,{className:"w-12 h-12 text-rose-500 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Suche Produktinfos..."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2 font-mono",children:n})]}):E?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(K,{className:"w-8 h-8 text-amber-600"})}),e.jsx("p",{className:"font-bold text-lg mb-1",children:"Produkt nicht in Datenbank"}),e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Barcode erkannt:"}),e.jsx("p",{className:"text-lg font-mono font-bold text-rose-600 mb-4",children:n}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Dieses Produkt ist nicht in Open Food Facts oder UPC Database.",e.jsx("br",{}),"Nutze AI-Erkennung oder gib es manuell ein."]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:B,className:"w-full py-4 bg-blue-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2",children:"ðŸ¤– Mit AI erkennen (Foto)"}),e.jsx("button",{onClick:()=>x(n),className:"w-full py-3 bg-gray-200 text-gray-700 rounded-xl font-medium",children:"âœï¸ Manuell eingeben"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 mb-4",children:[a!=null&&a.image?e.jsx("img",{src:a.image,alt:"",className:"w-20 h-20 object-cover rounded-xl bg-gray-100"}):e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-xl flex items-center justify-center",children:e.jsx(H,{className:"w-10 h-10 text-gray-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-lg leading-tight",children:a==null?void 0:a.name}),(a==null?void 0:a.brand)&&e.jsx("p",{className:"text-gray-500 text-sm",children:a.brand}),(a==null?void 0:a.quantity_info)&&e.jsx("p",{className:"text-rose-600 font-medium text-sm mt-1",children:a.quantity_info}),e.jsx("p",{className:"text-xs text-gray-400 font-mono mt-1",children:n})]})]}),((a==null?void 0:a.nutrition)||(a==null?void 0:a.ingredients))&&e.jsxs("div",{className:"mb-4",children:[e.jsx("button",{onClick:()=>L(!p),className:"w-full py-2 text-sm text-rose-600 font-medium flex items-center justify-center gap-1",children:p?"â–² Weniger Details":"â–¼ Mehr Details anzeigen"}),p&&e.jsxs("div",{className:"mt-2 p-3 bg-gray-50 rounded-xl text-sm space-y-3",children:[(a.nutriscore||a.ecoscore)&&e.jsxs("div",{className:"flex gap-2",children:[a.nutriscore&&e.jsxs("span",{className:`px-2 py-1 rounded font-bold text-white text-xs ${a.nutriscore==="A"?"bg-green-500":a.nutriscore==="B"?"bg-lime-500":a.nutriscore==="C"?"bg-yellow-500":a.nutriscore==="D"?"bg-orange-500":"bg-red-500"}`,children:["Nutri-Score ",a.nutriscore]}),a.ecoscore&&e.jsxs("span",{className:`px-2 py-1 rounded font-bold text-white text-xs ${a.ecoscore==="A"?"bg-green-500":a.ecoscore==="B"?"bg-lime-500":a.ecoscore==="C"?"bg-yellow-500":"bg-orange-500"}`,children:["Eco-Score ",a.ecoscore]})]}),a.nutrition&&Object.values(a.nutrition).some(h=>h)&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700 mb-1",children:"NÃ¤hrwerte (pro 100g):"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs",children:[a.nutrition.energy_kcal&&e.jsxs("div",{children:["Kalorien: ",e.jsxs("b",{children:[Math.round(a.nutrition.energy_kcal)," kcal"]})]}),a.nutrition.fat&&e.jsxs("div",{children:["Fett: ",e.jsxs("b",{children:[a.nutrition.fat,"g"]})]}),a.nutrition.carbs&&e.jsxs("div",{children:["Kohlenhydrate: ",e.jsxs("b",{children:[a.nutrition.carbs,"g"]})]}),a.nutrition.sugar&&e.jsxs("div",{children:["Zucker: ",e.jsxs("b",{children:[a.nutrition.sugar,"g"]})]}),a.nutrition.protein&&e.jsxs("div",{children:["EiweiÃŸ: ",e.jsxs("b",{children:[a.nutrition.protein,"g"]})]}),a.nutrition.salt&&e.jsxs("div",{children:["Salz: ",e.jsxs("b",{children:[a.nutrition.salt,"g"]})]})]})]}),a.ingredients&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700 mb-1",children:"Zutaten:"}),e.jsx("p",{className:"text-xs text-gray-600 line-clamp-3",children:a.ingredients})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Menge hinzufÃ¼gen"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>k(Math.max(1,S-1)),className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(G,{className:"w-6 h-6"})}),e.jsx("input",{type:"number",value:S,onChange:h=>k(Math.max(1,parseInt(h.target.value)||1)),className:"w-20 text-center text-3xl font-bold border-b-2 border-rose-500 focus:outline-none"}),e.jsx("button",{onClick:()=>k(S+1),className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(J,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"grid grid-cols-5 gap-2 mb-4",children:[1,5,10,20,50].map(h=>e.jsx("button",{onClick:()=>k(h),className:`py-2 rounded-lg font-semibold text-sm ${S===h?"bg-rose-500 text-white":"bg-gray-100 text-gray-700"}`,children:h},h))}),e.jsxs("button",{onClick:()=>i({...a,quantity:S}),className:"w-full py-4 bg-rose-500 text-white rounded-xl font-bold flex items-center justify-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),r?"Bestand erhÃ¶hen":"HinzufÃ¼gen + zum Shop"]}),!r&&e.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"Produkt wird auch im Shop angelegt"})]})})]})})}function pe({barcode:n,onConfirm:r,onCancel:i}){const[o,x]=t.useState({name:"",brand:"",price:"",category:"Sonstiges",quantity:1,barcode:n||""}),y=["GetrÃ¤nke","Snacks","SÃ¼ÃŸigkeiten","Obst & GemÃ¼se","Milchprodukte","TiefkÃ¼hl","Haushalt","Pflege","Sonstiges"],j=a=>{a.preventDefault(),o.name.trim()&&r(o)};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 flex items-end sm:items-center justify-center",children:e.jsxs("div",{className:"bg-white w-full sm:w-96 sm:rounded-2xl rounded-t-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-4 py-3 flex items-center justify-between rounded-t-3xl",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Neues Produkt"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(q,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:j,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Barcode"}),e.jsx("input",{type:"text",value:o.barcode,onChange:a=>x({...o,barcode:a.target.value}),className:"w-full p-3 border rounded-xl bg-gray-50 font-mono",placeholder:"EAN/UPC"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produktname *"}),e.jsx("input",{type:"text",value:o.name,onChange:a=>x({...o,name:a.target.value}),className:"w-full p-3 border rounded-xl focus:ring-2 focus:ring-rose-500",placeholder:"z.B. Coca-Cola 0,5L",required:!0,autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Marke"}),e.jsx("input",{type:"text",value:o.brand,onChange:a=>x({...o,brand:a.target.value}),className:"w-full p-3 border rounded-xl",placeholder:"z.B. Coca-Cola"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kategorie"}),e.jsx("select",{value:o.category,onChange:a=>x({...o,category:a.target.value}),className:"w-full p-3 border rounded-xl bg-white",children:y.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Preis (â‚¬)"}),e.jsx("input",{type:"number",step:"0.01",value:o.price,onChange:a=>x({...o,price:a.target.value}),className:"w-full p-3 border rounded-xl",placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Menge"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>x({...o,quantity:Math.max(1,o.quantity-1)}),className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(G,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-3xl font-bold w-16 text-center",children:o.quantity}),e.jsx("button",{type:"button",onClick:()=>x({...o,quantity:o.quantity+1}),className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(J,{className:"w-5 h-5"})})]})]}),e.jsx("button",{type:"submit",className:"w-full py-4 bg-rose-500 text-white rounded-xl font-bold",children:"Produkt anlegen"})]})]})})}function je({item:n,onSave:r,onCancel:i,token:o}){const[x,y]=t.useState({name:n.name||"",brand:n.brand||"",category:n.category||"Sonstiges",price:n.price||"",image:n.image||"",min_stock:n.min_stock||5}),[j,a]=t.useState(!1),w=t.useRef(null),S=["GetrÃ¤nke","Snacks","SÃ¼ÃŸigkeiten","Obst & GemÃ¼se","Milchprodukte","TiefkÃ¼hl","Haushalt","Pflege","Sonstiges"],k=async d=>{var R;const p=(R=d.target.files)==null?void 0:R[0];if(!p)return;a(!0);const L=new FormData;L.append("image",p);try{const B=await fetch("/api/upload/product",{method:"POST",headers:{Authorization:`Bearer ${o}`},body:L});if(B.ok){const M=await B.json();y({...x,image:M.url})}}catch(B){console.error("Upload failed:",B)}a(!1)},E=d=>{d.preventDefault(),r({...n,...x})};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 flex items-end sm:items-center justify-center",children:e.jsxs("div",{className:"bg-white w-full sm:w-96 sm:rounded-2xl rounded-t-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-4 py-3 flex items-center justify-between rounded-t-3xl",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Produkt bearbeiten"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(q,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:E,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Produktbild"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{onClick:()=>{var d;return(d=w.current)==null?void 0:d.click()},className:"w-24 h-24 rounded-xl bg-gray-100 flex items-center justify-center cursor-pointer overflow-hidden border-2 border-dashed border-gray-300 hover:border-rose-500 transition-colors",children:j?e.jsx(W,{className:"w-8 h-8 text-rose-500 animate-spin"}):x.image?e.jsx("img",{src:x.image,alt:"",className:"w-full h-full object-cover"}):e.jsx(Q,{className:"w-8 h-8 text-gray-400"})}),e.jsx("input",{ref:w,type:"file",accept:"image/*",className:"hidden",onChange:k}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Klicke zum Hochladen"}),e.jsx("p",{className:"text-xs text-gray-400",children:"JPG, PNG max. 5MB"}),x.image&&e.jsx("button",{type:"button",onClick:()=>y({...x,image:""}),className:"text-xs text-red-500 mt-1",children:"Bild entfernen"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:x.name,onChange:d=>y({...x,name:d.target.value}),className:"w-full p-3 border rounded-xl",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Marke"}),e.jsx("input",{type:"text",value:x.brand,onChange:d=>y({...x,brand:d.target.value}),className:"w-full p-3 border rounded-xl"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kategorie"}),e.jsx("select",{value:x.category,onChange:d=>y({...x,category:d.target.value}),className:"w-full p-3 border rounded-xl bg-white",children:S.map(d=>e.jsx("option",{value:d,children:d},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Preis (â‚¬)"}),e.jsx("input",{type:"number",step:"0.01",value:x.price,onChange:d=>y({...x,price:d.target.value}),className:"w-full p-3 border rounded-xl"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Min. Bestand (Warnung)"}),e.jsx("input",{type:"number",value:x.min_stock,onChange:d=>y({...x,min_stock:parseInt(d.target.value)||5}),className:"w-full p-3 border rounded-xl"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:i,className:"flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium",children:"Abbrechen"}),e.jsx("button",{type:"submit",className:"flex-1 py-3 bg-rose-500 text-white rounded-xl font-bold",children:"Speichern"})]})]})]})})}const ye=t.memo(function({item:r,onUpdateStock:i,onEdit:o,onDelete:x}){const y=r.stock===0?"text-red-500 border-red-500":r.stock<=10?"text-amber-500 border-amber-500":"text-green-600 border-green-500";return e.jsxs("div",{className:`bg-white rounded-xl p-4 shadow-sm border-l-4 ${r.stock===0?"border-l-red-500":r.stock<=10?"border-l-amber-500":"border-l-green-500"}`,children:[e.jsxs("div",{className:"flex gap-3",children:[r.image?e.jsx("img",{src:r.image,alt:"",className:"w-16 h-16 object-cover rounded-lg bg-gray-100"}):e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(H,{className:"w-8 h-8 text-gray-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",onClick:()=>o(r),children:[e.jsx("h3",{className:"font-semibold truncate",children:r.name}),r.brand&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:r.brand}),e.jsx("p",{className:"text-xs text-gray-400 font-mono mt-1",children:r.barcode||"â€”"})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("div",{className:`text-2xl font-bold ${y}`,children:r.stock}),e.jsx("p",{className:"text-xs text-gray-400",children:"StÃ¼ck"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-3 pt-3 border-t",children:[e.jsx("button",{onClick:()=>i(r.id,-1),disabled:r.stock===0,className:"flex-1 py-2 bg-red-50 text-red-600 rounded-lg font-medium text-sm disabled:opacity-40",children:"-1"}),e.jsx("button",{onClick:()=>i(r.id,-5),disabled:r.stock<5,className:"flex-1 py-2 bg-red-50 text-red-600 rounded-lg font-medium text-sm disabled:opacity-40",children:"-5"}),e.jsx("button",{onClick:()=>i(r.id,5),className:"flex-1 py-2 bg-green-50 text-green-600 rounded-lg font-medium text-sm",children:"+5"}),e.jsx("button",{onClick:()=>i(r.id,1),className:"flex-1 py-2 bg-green-50 text-green-600 rounded-lg font-medium text-sm",children:"+1"}),e.jsx("button",{onClick:()=>o(r),className:"py-2 px-3 bg-blue-50 text-blue-600 rounded-lg",children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>x(r.id),className:"py-2 px-3 bg-gray-100 text-gray-600 rounded-lg",children:e.jsx(he,{className:"w-4 h-4"})})]})]})});function ve(){const n=X(),{user:r,token:i}=Y(),[o,x]=t.useState([]),[y,j]=t.useState(!0),[a,w]=t.useState(!1),[S,k]=t.useState(null),[E,d]=t.useState(null),[p,L]=t.useState(!1),[R,B]=t.useState(""),[M,h]=t.useState(null),[g,P]=t.useState(""),[N,z]=t.useState("all"),[_,v]=t.useState(null);t.useEffect(()=>{if(!r||r.role!=="admin"){n("/login");return}m()},[r,n]);const m=async()=>{try{const s=await fetch("/api/inventory",{headers:{Authorization:`Bearer ${i}`}});s.ok&&x(await s.json())}catch(s){console.error("Load inventory error:",s)}j(!1)},l=(s,f="success")=>{v({msg:s,type:f}),setTimeout(()=>v(null),3e3)},c=t.useCallback(s=>{w(!1);const f=o.find(O=>O.barcode===s);f&&d(f),k(s)},[o]),u=async s=>{try{const f=E?`/api/inventory/${E.id}/stock`:"/api/inventory/add";(await fetch(f,{method:E?"PATCH":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(E?{change:s.quantity}:s)})).ok?(l(`${s.quantity}x ${s.name} ${E?"aufgefÃ¼llt":"hinzugefÃ¼gt"}!`),m()):l("Fehler beim Speichern","error")}catch{l("Netzwerkfehler","error")}k(null),d(null)},b=s=>{k(null),d(null),B(s||""),L(!0)},I=async s=>{try{(await fetch("/api/inventory/add",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({...s,source:"Manual"})})).ok?(l(`${s.quantity}x ${s.name} hinzugefÃ¼gt!`),m()):l("Fehler","error")}catch{l("Netzwerkfehler","error")}L(!1)},A=async(s,f)=>{try{(await fetch(`/api/inventory/${s}/stock`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({change:f})})).ok&&m()}catch{l("Fehler","error")}},F=async s=>{if(confirm("Produkt wirklich lÃ¶schen?"))try{(await fetch(`/api/inventory/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`}})).ok&&(l("GelÃ¶scht"),m())}catch{l("Fehler","error")}},T=async s=>{try{(await fetch(`/api/inventory/${s.id}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({name:s.name,brand:s.brand,category:s.category,price:s.price,image:s.image,min_stock:s.min_stock})})).ok?(l("Gespeichert!"),m()):l("Fehler beim Speichern","error")}catch{l("Netzwerkfehler","error")}h(null)},$=o.filter(s=>{var f,O,V;if(g){const U=g.toLowerCase();if(!((f=s.name)!=null&&f.toLowerCase().includes(U))&&!((O=s.barcode)!=null&&O.includes(U))&&!((V=s.brand)!=null&&V.toLowerCase().includes(U)))return!1}return!(N==="low"&&s.stock>10||N==="out"&&s.stock>0)}),C={total:o.length,totalStock:o.reduce((s,f)=>s+(f.stock||0),0),low:o.filter(s=>s.stock>0&&s.stock<=10).length,out:o.filter(s=>s.stock===0).length};return!r||r.role!=="admin"?null:e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsx("div",{className:"bg-gradient-to-br from-rose-600 via-rose-700 to-rose-800 text-white",children:e.jsxs("div",{className:"p-4 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Lagerverwaltung"}),e.jsx("p",{className:"text-rose-200 text-sm",children:"Bestand & Barcode-Scanner"})]}),e.jsx("button",{onClick:()=>n("/admin"),className:"p-2 bg-white/20 rounded-full backdrop-blur",children:e.jsx(q,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"bg-white/15 backdrop-blur rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:C.total}),e.jsx("p",{className:"text-xs text-rose-200",children:"Produkte"})]}),e.jsxs("div",{className:"bg-white/15 backdrop-blur rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:C.totalStock}),e.jsx("p",{className:"text-xs text-rose-200",children:"Einheiten"})]}),e.jsxs("div",{className:"bg-white/15 backdrop-blur rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-amber-300",children:C.low}),e.jsx("p",{className:"text-xs text-rose-200",children:"Niedrig"})]}),e.jsxs("div",{className:"bg-white/15 backdrop-blur rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-300",children:C.out}),e.jsx("p",{className:"text-xs text-rose-200",children:"Leer"})]})]})]})}),e.jsxs("div",{className:"sticky top-0 z-10 bg-white border-b p-4 shadow-sm",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx(ie,{className:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:g,onChange:s=>P(s.target.value),placeholder:"Suche nach Name oder Barcode...",className:"w-full pl-10 pr-4 py-3 border rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-rose-500"})]}),e.jsx("div",{className:"flex gap-2",children:[{k:"all",l:"Alle",c:C.total},{k:"low",l:"Niedrig",c:C.low},{k:"out",l:"Leer",c:C.out}].map(s=>e.jsxs("button",{onClick:()=>z(s.k),className:`px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 transition-all ${N===s.k?"bg-rose-500 text-white":"bg-gray-100 text-gray-700"}`,children:[s.l,e.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-xs ${N===s.k?"bg-white/20":"bg-gray-200"}`,children:s.c})]},s.k))})]}),e.jsx("div",{className:"p-4 space-y-3",children:y?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(W,{className:"w-12 h-12 text-rose-500 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Lade Inventar..."})]}):$.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(H,{className:"w-20 h-20 text-gray-200 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium mb-1",children:g?"Keine Treffer":"Noch keine Produkte"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Scanne einen Barcode zum HinzufÃ¼gen"})]}):$.map(s=>e.jsx(ye,{item:s,onUpdateStock:A,onEdit:h,onDelete:F},s.id))}),e.jsxs("div",{className:"fixed bottom-6 right-4 flex flex-col gap-3",children:[e.jsx("button",{onClick:()=>L(!0),className:"w-14 h-14 bg-gray-800 text-white rounded-full shadow-lg flex items-center justify-center",children:e.jsx(ne,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>w(!0),className:"w-16 h-16 bg-rose-500 text-white rounded-full shadow-xl flex items-center justify-center animate-pulse",children:e.jsx(Q,{className:"w-8 h-8"})})]}),a&&e.jsx(fe,{onScan:c,onClose:()=>w(!1)}),S&&e.jsx(be,{barcode:S,existingProduct:E,onConfirm:u,onCancel:()=>{k(null),d(null)},onManualAdd:b}),p&&e.jsx(pe,{barcode:R,onConfirm:I,onCancel:()=>{L(!1),B("")}}),M&&e.jsx(je,{item:M,token:i,onSave:T,onCancel:()=>h(null)}),_&&e.jsxs("div",{className:`fixed top-4 left-4 right-4 p-4 rounded-xl shadow-lg z-50 flex items-center gap-3 animate-slide-down ${_.type==="error"?"bg-red-500":"bg-green-500"} text-white`,children:[_.type==="error"?e.jsx(K,{className:"w-6 h-6"}):e.jsx(Z,{className:"w-6 h-6"}),e.jsx("span",{className:"font-medium",children:_.msg})]})]})}export{ve as default};
