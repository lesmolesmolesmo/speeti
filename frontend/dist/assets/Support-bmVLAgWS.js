import{c as D,b as E,a as I,r as a,g as u,j as e,H as g,L as f,d as L,U as A}from"./index-TnPH2S_w.js";import{l as B}from"./index-CyTcV1HU.js";import{B as j}from"./bot-kVKhgGDd.js";import{S as T}from"./send-CWO-Q0mc.js";/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=D("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function O(){const{user:N}=E(),[w]=I(),n=w.get("order"),[t,p]=a.useState(null),[c,i]=a.useState([]),[l,x]=a.useState(""),[v,S]=a.useState(!0),[d,h]=a.useState(!1),[o,_]=a.useState(null),y=a.useRef(null);a.useEffect(()=>{z();const s=B();return s.on("support-message",r=>{r.ticket_id===(t==null?void 0:t.id)&&M()}),_(s),()=>s.disconnect()},[]),a.useEffect(()=>{t&&(o==null||o.emit("join-support",t.id))},[t,o]),a.useEffect(()=>{k()},[c]);const k=()=>{var s;(s=y.current)==null||s.scrollIntoView({behavior:"smooth"})},z=async()=>{try{const s=await u.post("/support/ticket",{order_id:n?parseInt(n):null});p(s.data.ticket),i(s.data.messages)}catch(s){console.error("Error loading ticket:",s)}finally{S(!1)}},M=async()=>{if(t)try{const s=await u.post("/support/ticket",{order_id:t.order_id});i(s.data.messages)}catch(s){console.error("Error fetching messages:",s)}},b=async()=>{if(!l.trim()||d||!t)return;const s=l.trim();x(""),h(!0),i(r=>[...r,{id:Date.now(),sender_type:"user",message:s,created_at:new Date().toISOString()}]);try{const r=await u.post("/support/message",{ticket_id:t.id,message:s});i(m=>[...m,{id:Date.now()+1,sender_type:r.data.escalated?"system":"ai",message:r.data.response,created_at:new Date().toISOString()}]),r.data.escalated&&p(m=>({...m,escalated:1}))}catch(r){console.error("Error sending message:",r)}finally{h(!1)}};return N?v?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-rose-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx("header",{className:"bg-white sticky top-0 z-40 border-b border-gray-100",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-4 flex items-center gap-4",children:[e.jsx(f,{to:n?`/orders/${n}`:"/",className:"p-2 -ml-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(L,{size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(g,{size:20,className:"text-rose-500"}),"Support"]}),e.jsx("p",{className:"text-sm text-gray-500",children:t!=null&&t.escalated?"ðŸ‘¤ Mit Mitarbeiter verbunden":"ðŸ¤– KI-Assistent"})]})]})}),t!=null&&t.escalated?e.jsx("div",{className:"bg-amber-50 border-b border-amber-100 px-4 py-3",children:e.jsxs("div",{className:"max-w-lg mx-auto flex items-center gap-2 text-sm text-amber-800",children:[e.jsx($,{size:16}),e.jsx("span",{children:"Du wurdest an einen Mitarbeiter weitergeleitet. Wir antworten so schnell wie mÃ¶glich."})]})}):null,e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:e.jsxs("div",{className:"max-w-lg mx-auto space-y-4",children:[c.map((s,r)=>e.jsx("div",{className:`flex ${s.sender_type==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex items-end gap-2 max-w-[85%] ${s.sender_type==="user"?"flex-row-reverse":""}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${s.sender_type==="user"?"bg-rose-500 text-white":s.sender_type==="admin"?"bg-blue-500 text-white":"bg-gray-200 text-gray-600"}`,children:s.sender_type==="user"?e.jsx(A,{size:16}):s.sender_type==="admin"?e.jsx(g,{size:16}):e.jsx(j,{size:16})}),e.jsxs("div",{className:`px-4 py-3 rounded-2xl ${s.sender_type==="user"?"bg-rose-500 text-white rounded-br-md":s.sender_type==="admin"?"bg-blue-500 text-white rounded-bl-md":s.sender_type==="system"?"bg-amber-100 text-amber-800 rounded-bl-md":"bg-white text-gray-900 shadow-sm border border-gray-100 rounded-bl-md"}`,children:[s.sender_type==="ai"&&e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Speeti Bot"}),s.sender_type==="admin"&&e.jsx("p",{className:"text-xs text-blue-100 mb-1",children:"Support-Team"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.message})]})]})},s.id||r)),d&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx(j,{size:16,className:"text-gray-600"})}),e.jsx("div",{className:"bg-white shadow-sm border border-gray-100 px-4 py-3 rounded-2xl rounded-bl-md",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]})}),e.jsx("div",{ref:y})]})}),e.jsx("div",{className:"bg-white border-t border-gray-100 p-4",children:e.jsxs("div",{className:"max-w-lg mx-auto flex gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:s=>x(s.target.value),onKeyDown:s=>s.key==="Enter"&&!s.shiftKey&&b(),placeholder:"Nachricht eingeben...",className:"flex-1 px-4 py-3 bg-gray-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500",disabled:d}),e.jsx("button",{onClick:b,disabled:!l.trim()||d,className:"w-12 h-12 bg-rose-500 text-white rounded-xl flex items-center justify-center hover:bg-rose-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(T,{size:20})})]})}),c.length<=2&&!(t!=null&&t.escalated)&&e.jsx("div",{className:"bg-gray-50 border-t border-gray-100 p-4",children:e.jsxs("div",{className:"max-w-lg mx-auto",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Schnellfragen:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["Wie lange dauert die Lieferung?","Bestellung stornieren","Artikel fehlt","Mit Mitarbeiter sprechen"].map(s=>e.jsx("button",{onClick:()=>x(s),className:"px-3 py-1.5 bg-white border border-gray-200 rounded-full text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:s},s))})]})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(g,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Bitte einloggen"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Du musst eingeloggt sein, um den Support zu kontaktieren."}),e.jsx(f,{to:"/login",className:"text-rose-500 font-medium",children:"Zum Login â†’"})]})})}export{O as default};
