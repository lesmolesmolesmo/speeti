import{c as U,r as a,j as e,X as T,i as g,g as S,k as q,b as O,T as A,h as K,L as E,d as W,C as Z,U as $,l as B,H as L,M as V}from"./index-TnPH2S_w.js";import{S as G}from"./send-CWO-Q0mc.js";import{l as J}from"./index-CyTcV1HU.js";import{P as I}from"./package-DJqEn-u_.js";import{M as H}from"./message-circle-DwikqqP-.js";import{D as Q}from"./download-BWAFhTqI.js";/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=U("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);function Y({orderId:i,driverName:s,onClose:d,onRated:n}){const[l,f]=a.useState(0),[w,j]=a.useState(0),[x,p]=a.useState(""),[b,m]=a.useState(!1),[y,o]=a.useState(""),h={1:"Schlecht",2:"Geht so",3:"Okay",4:"Gut",5:"Super!"},N=async()=>{var r,u;if(l===0){o("Bitte wÃ¤hle eine Bewertung");return}m(!0),o("");try{await S.post(`/orders/${i}/rating`,{rating:l,comment:x}),n==null||n(),d()}catch(v){o(((u=(r=v.response)==null?void 0:r.data)==null?void 0:u.error)||"Fehler beim Speichern")}finally{m(!1)}};return e.jsxs("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:[e.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-sm overflow-hidden animate-scale-in",children:[e.jsxs("div",{className:"relative bg-gradient-to-r from-rose-500 to-pink-500 p-6 text-center text-white",children:[e.jsx("button",{onClick:d,className:"absolute top-4 right-4 w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(T,{size:18})}),e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(g,{size:32})}),e.jsx("h2",{className:"text-xl font-bold",children:"Wie war's?"}),e.jsxs("p",{className:"text-rose-100 text-sm mt-1",children:["Bewerte ",s||"deinen Fahrer"]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-center gap-2 mb-4",children:[1,2,3,4,5].map(r=>e.jsx("button",{onClick:()=>f(r),onMouseEnter:()=>j(r),onMouseLeave:()=>j(0),className:"transition-transform hover:scale-110 active:scale-95",children:e.jsx(g,{size:40,className:`${r<=(w||l)?"text-amber-400 fill-amber-400":"text-gray-300"} transition-colors`})},r))}),e.jsx("p",{className:"text-center font-semibold text-gray-900 h-6 mb-4",children:h[w||l]||"Tippe auf die Sterne"}),e.jsx("textarea",{value:x,onChange:r=>p(r.target.value),placeholder:"Optionaler Kommentar...",rows:3,className:"w-full p-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 resize-none text-sm"}),y&&e.jsx("p",{className:"text-red-500 text-sm text-center mt-2",children:y}),e.jsx("button",{onClick:N,disabled:b||l===0,className:"w-full mt-4 py-4 bg-gradient-to-r from-rose-500 to-pink-500 text-white font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:b?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(G,{size:18})," Bewertung abschicken"]})}),e.jsx("button",{onClick:d,className:"w-full mt-2 py-2 text-gray-500 text-sm hover:text-gray-700",children:"SpÃ¤ter bewerten"})]})]}),e.jsx("style",{children:`
        @keyframes scale-in {
          from { transform: scale(0.9); opacity: 0; }
          to { transform: scale(1); opacity: 1; }
        }
        .animate-scale-in {
          animation: scale-in 0.2s ease-out;
        }
      `})]})}const k=[{key:"confirmed",label:"BestÃ¤tigt",icon:I},{key:"picking",label:"Wird gepackt",icon:I},{key:"delivering",label:"Unterwegs",icon:A},{key:"delivered",label:"Geliefert",icon:K}];function ne(){var z,_,C,F,D,M;const{id:i}=q(),{currentOrder:s,fetchOrder:d,user:n}=O(),[l,f]=a.useState(""),[w,j]=a.useState(null),[x,p]=a.useState(!1),[b,m]=a.useState(!1),[y,o]=a.useState(!1),h=a.useRef(null);a.useEffect(()=>{d(i),N();const t=J();return t.emit("join-order",i),t.on("order-update",c=>{c.orderId===parseInt(i)&&d(i)}),t.on("new-message",c=>{c.order_id===parseInt(i)&&d(i)}),j(t),()=>t.disconnect()},[i]);const N=async()=>{try{const{data:t}=await S.get(`/orders/${i}/rating`);o(!!t)}catch{o(!1)}};a.useEffect(()=>{x&&h.current&&h.current.scrollIntoView({behavior:"smooth"})},[s==null?void 0:s.messages,x]);const r=async()=>{l.trim()&&(await S.post(`/orders/${i}/messages`,{message:l}),f(""))};if(!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-rose-500 border-t-transparent rounded-full animate-spin"})});const u=k.findIndex(t=>t.key===s.status),v=s.driver_id&&s.status!=="delivered";return["confirmed","picking","delivering"].includes(s.status),e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsx("header",{className:"bg-white sticky top-0 z-40 border-b border-gray-100",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-4 flex items-center gap-4",children:[e.jsx(E,{to:"/orders",className:"p-2 -ml-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(W,{size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900",children:["Bestellung #",s.id]}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString("de-DE",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-6 space-y-6",children:[s.status!=="cancelled"&&e.jsxs("section",{className:"bg-white rounded-2xl p-4",children:[e.jsx("h2",{className:"font-semibold text-gray-900 mb-4",children:"Bestellstatus"}),e.jsxs("div",{className:"flex items-center justify-between relative",children:[e.jsx("div",{className:"absolute top-4 left-0 right-0 h-1 bg-gray-200",children:e.jsx("div",{className:"h-full bg-rose-500 transition-all duration-500",style:{width:`${Math.max(0,u/(k.length-1)*100)}%`}})}),k.map((t,c)=>{const R=c<=u,P=t.icon;return e.jsxs("div",{className:"flex flex-col items-center relative z-10",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${R?"bg-rose-500 text-white":"bg-gray-200 text-gray-400"}`,children:e.jsx(P,{size:16})}),e.jsx("span",{className:`text-xs mt-2 ${R?"text-rose-600 font-medium":"text-gray-400"}`,children:t.label})]},t.key)})]}),s.estimated_delivery&&s.status!=="delivered"&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Z,{size:16}),e.jsxs("span",{children:["GeschÃ¤tzte Ankunft: ",new Date(s.estimated_delivery).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})," Uhr"]})]})]}),v&&e.jsxs("section",{className:"bg-white rounded-2xl p-4",children:[e.jsxs("h2",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(A,{size:18,className:"text-rose-500"})," Dein Fahrer"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-rose-100 rounded-full flex items-center justify-center",children:e.jsx($,{size:24,className:"text-rose-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.driver_name||"Fahrer"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Unterwegs zu dir"})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[s.driver_phone&&e.jsxs("a",{href:`tel:${s.driver_phone}`,className:"flex items-center justify-center gap-2 py-3 bg-green-500 text-white rounded-xl font-medium hover:bg-green-600 transition-colors",children:[e.jsx(B,{size:18}),"Anrufen"]}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center justify-center gap-2 py-3 bg-rose-500 text-white rounded-xl font-medium hover:bg-rose-600 transition-colors",children:[e.jsx(H,{size:18}),"Chat"]})]})]}),e.jsxs("section",{className:"bg-white rounded-2xl p-4",children:[e.jsxs("h2",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(L,{size:18,className:"text-rose-500"})," Hilfe & Support"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Problem mit der Bestellung? Unser KI-Assistent hilft dir sofort - oder leitet dich an einen Mitarbeiter weiter."}),e.jsxs(E,{to:`/support?order=${s.id}`,className:"flex items-center justify-center gap-2 py-3 bg-gray-900 text-white rounded-xl font-medium hover:bg-gray-800 transition-colors",children:[e.jsx(L,{size:18}),"Support kontaktieren"]})]}),e.jsxs("section",{className:"bg-white rounded-2xl p-4",children:[e.jsxs("h2",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(V,{size:18,className:"text-rose-500"})," Lieferadresse"]}),e.jsxs("p",{className:"text-gray-600",children:[s.street," ",s.house_number]}),e.jsxs("p",{className:"text-gray-600",children:[s.postal_code," ",s.city]}),s.instructions&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 italic",children:['"',s.instructions,'"']})]}),e.jsxs("section",{className:"bg-white rounded-2xl p-4",children:[e.jsx("h2",{className:"font-semibold text-gray-900 mb-3",children:"Artikel"}),(z=s.items)==null?void 0:z.map(t=>{var c;return e.jsxs("div",{className:"flex items-center gap-3 py-2 border-b border-gray-100 last:border-0",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0",children:t.image?e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xl",children:"ðŸ“¦"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.quantity,"x ",(c=t.price)==null?void 0:c.toFixed(2)," â‚¬"]})]}),e.jsxs("span",{className:"font-medium",children:[(t.quantity*t.price).toFixed(2)," â‚¬"]})]},t.id)}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Zwischensumme"}),e.jsxs("span",{children:[(_=s.subtotal)==null?void 0:_.toFixed(2)," â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Lieferung"}),e.jsxs("span",{children:[(C=s.delivery_fee)==null?void 0:C.toFixed(2)," â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-gray-900 text-base",children:[e.jsx("span",{children:"Gesamt"}),e.jsxs("span",{children:[(F=s.total)==null?void 0:F.toFixed(2)," â‚¬"]})]})]})]}),s.status==="delivered"&&e.jsxs("section",{className:"bg-white rounded-2xl p-4",children:[e.jsxs("h2",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(X,{size:18,className:"text-rose-500"})," Rechnung / Quittung"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Rechnungsnummer"}),e.jsxs("span",{className:"font-medium",children:["RE-",String(s.id).padStart(5,"0")]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Bestelldatum"}),e.jsx("span",{className:"font-medium",children:new Date(s.created_at).toLocaleDateString("de-DE")})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Gesamtbetrag"}),e.jsxs("span",{className:"font-bold text-rose-500",children:[(D=s.total)==null?void 0:D.toFixed(2)," â‚¬"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Zahlungsstatus"}),e.jsx("span",{className:`font-medium ${s.payment_status==="paid"?"text-green-600":"text-amber-600"}`,children:s.payment_status==="paid"?"âœ“ Bezahlt":"Ausstehend"})]}),e.jsxs("a",{href:`/api/orders/${s.id}/invoice`,target:"_blank",className:"flex items-center justify-center gap-2 w-full py-3 bg-rose-500 text-white rounded-xl font-medium hover:bg-rose-600 transition-colors mt-4",children:[e.jsx(Q,{size:18}),"Rechnung herunterladen (PDF)"]}),e.jsx("p",{className:"text-xs text-center text-gray-400 mt-2",children:"Die Rechnung enthÃ¤lt alle steuerlichen Angaben gemÃ¤ÃŸ Â§ 14 UStG."})]})]}),s.status==="delivered"&&s.driver_id&&e.jsxs("section",{className:"bg-white rounded-2xl p-4",children:[e.jsxs("h2",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(g,{size:18,className:"text-amber-500"})," Bewertung"]}),y?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"flex justify-center gap-1 mb-2",children:[1,2,3,4,5].map(t=>e.jsx(g,{size:24,className:"text-amber-400 fill-amber-400"},t))}),e.jsx("p",{className:"text-sm text-gray-500",children:"Danke fÃ¼r deine Bewertung! â­"})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Wie war deine Erfahrung mit ",s.driver_name||"deinem Fahrer","?"]}),e.jsxs("button",{onClick:()=>m(!0),className:"px-6 py-3 bg-gradient-to-r from-amber-400 to-orange-500 text-white font-bold rounded-xl flex items-center gap-2 mx-auto hover:shadow-lg transition-shadow",children:[e.jsx(g,{size:18})," Jetzt bewerten"]})]})]})]}),b&&e.jsx(Y,{orderId:s.id,driverName:s.driver_name,onClose:()=>m(!1),onRated:()=>{o(!0),N()}}),x&&v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-end lg:items-center lg:justify-center pb-20 lg:pb-0",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-t-2xl lg:rounded-2xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-rose-100 rounded-full flex items-center justify-center",children:e.jsx($,{size:20,className:"text-rose-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.driver_name||"Fahrer"}),e.jsx("p",{className:"text-xs text-green-500",children:"Online"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.driver_phone&&e.jsx("a",{href:`tel:${s.driver_phone}`,className:"w-10 h-10 bg-green-500 text-white rounded-full flex items-center justify-center hover:bg-green-600 transition-colors",children:e.jsx(B,{size:18})}),e.jsx("button",{onClick:()=>p(!1),className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors",children:"âœ•"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 min-h-[300px]",children:[((M=s.messages)==null?void 0:M.length)>0?s.messages.map(t=>e.jsxs("div",{className:`max-w-[80%] p-3 rounded-2xl text-sm ${t.sender_id===(n==null?void 0:n.id)?"ml-auto bg-rose-500 text-white rounded-br-md":"bg-gray-100 text-gray-900 rounded-bl-md"}`,children:[t.sender_id!==(n==null?void 0:n.id)&&e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:t.sender_name}),t.message]},t.id)):e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx(H,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Noch keine Nachrichten"}),e.jsx("p",{className:"text-xs mt-1",children:"Schreib deinem Fahrer eine Nachricht"})]}),e.jsx("div",{ref:h})]}),e.jsx("div",{className:"p-4 border-t border-gray-100 safe-bottom",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:t=>f(t.target.value),onKeyDown:t=>t.key==="Enter"&&r(),placeholder:"Nachricht an Fahrer...",className:"flex-1 px-4 py-3 bg-gray-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500"}),e.jsx("button",{onClick:r,disabled:!l.trim(),className:"w-12 h-12 bg-rose-500 text-white rounded-xl flex items-center justify-center hover:bg-rose-600 transition-colors disabled:opacity-50",children:e.jsx(G,{size:20})})]})})]})})]})}export{ne as default};
