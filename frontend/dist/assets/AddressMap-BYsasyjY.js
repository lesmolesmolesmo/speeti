import{c as G,r as l,j as e,X as K,S as Q,M as z,A as B,f as M}from"./index-TnPH2S_w.js";import{m as u}from"./mapbox-gl-CbJENOAs.js";import{N as H}from"./navigation-BMvs7t9G.js";/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=G("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]);u.accessToken="pk.eyJ1Ijoic3BlZXRpc3BlZXRpIiwiYSI6ImNtbDZ6dHJ4ZzAyZzczY3NpeDdhNHE4aWYifQ.WiNxZwRzk9aPGN9DrjyT3Q";const A=[7.6261,51.9607],C=(f,b)=>f>=7.45&&f<=7.8&&b>=51.85&&b<=52.08,J=l.memo(function({onAddressSelect:b,onClose:R}){const p=l.useRef(null),n=l.useRef(null),x=l.useRef(null),[y,w]=l.useState(""),[k,j]=l.useState([]),[I,L]=l.useState(!1),[o,m]=l.useState(null),[_,c]=l.useState(null),[S,h]=l.useState(!1),[T,E]=l.useState(!1);l.useEffect(()=>{if(!(n.current||!p.current)){try{n.current=new u.Map({container:p.current,style:"mapbox://styles/mapbox/streets-v12",center:A,zoom:13,maxBounds:[[7,51.5],[8.2,52.3]]}),n.current.on("load",()=>{E(!0),n.current.addSource("delivery-area",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[7.52,51.88],[7.72,51.88],[7.75,51.92],[7.75,52.02],[7.7,52.05],[7.55,52.05],[7.5,52],[7.48,51.94],[7.52,51.88]]]}}}),n.current.addLayer({id:"delivery-area-fill",type:"fill",source:"delivery-area",paint:{"fill-color":"#e11d48","fill-opacity":.1}}),n.current.addLayer({id:"delivery-area-outline",type:"line",source:"delivery-area",paint:{"line-color":"#e11d48","line-width":3,"line-dasharray":[2,2]}})}),n.current.addControl(new u.NavigationControl,"top-right"),x.current=new u.Marker({color:"#e11d48",draggable:!0}).setLngLat(A).addTo(n.current),x.current.on("dragend",async()=>{const s=x.current.getLngLat();await N(s.lng,s.lat)}),n.current.on("click",async s=>{x.current.setLngLat(s.lngLat),await N(s.lngLat.lng,s.lngLat.lat)})}catch(s){console.error("Map init error:",s),c("Karte konnte nicht geladen werden")}return()=>{n.current&&(n.current.remove(),n.current=null)}}},[]);const $=()=>{if(!navigator.geolocation){c("Geolocation nicht unterstÃ¼tzt");return}h(!0),navigator.geolocation.getCurrentPosition(async s=>{var a,d;const{longitude:t,latitude:r}=s.coords;C(t,r)?((a=n.current)==null||a.flyTo({center:[t,r],zoom:16}),(d=x.current)==null||d.setLngLat([t,r]),await N(t,r)):(c("Dein Standort liegt auÃŸerhalb von MÃ¼nster"),h(!1))},s=>{console.error("Geolocation error:",s),c("Standort konnte nicht ermittelt werden"),h(!1)},{enableHighAccuracy:!0,timeout:1e4})},N=async(s,t)=>{if(!C(s,t)){c("Diese Adresse liegt auÃŸerhalb von MÃ¼nster"),m(null),h(!1);return}h(!0),c(null);try{const a=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${s},${t}.json?access_token=${u.accessToken}&language=de&types=address`)).json();if(a.features&&a.features.length>0){const d=a.features[0],i=v(d);i.postal_code&&i.postal_code.startsWith("48")?(m(i),c(null)):(c("Nur Lieferung nach MÃ¼nster (PLZ 48xxx)"),m(null))}else{const i=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${s},${t}.json?access_token=${u.accessToken}&language=de`)).json();if(i.features&&i.features.length>0){const W=i.features[0],g=v(W);m({...g,street:g.street||"Unbekannte StraÃŸe",house_number:g.house_number||"",postal_code:g.postal_code||"48149",needsManualInput:!g.street})}else c("Keine Adresse gefunden - bitte StraÃŸe manuell eingeben")}}catch(r){console.error("Geocoding error:",r),c("Fehler bei der Adresssuche")}finally{h(!1)}},v=s=>{const t=s.context||[],r={full:s.place_name,street:"",house_number:"",postal_code:"",city:"MÃ¼nster",lng:s.center[0],lat:s.center[1]};return s.text&&(r.street=s.text),s.address&&(r.house_number=s.address),t.forEach(a=>{a.id.startsWith("postcode")&&(r.postal_code=a.text),a.id.startsWith("place")&&(r.city=a.text)}),r},Z=async s=>{if(!s||s.length<3){j([]);return}L(!0);try{const r=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(s+" MÃ¼nster")}.json?access_token=${u.accessToken}&language=de&country=de&bbox=7.45,51.85,7.80,52.08&types=address,poi&limit=5`)).json();j(r.features||[])}catch(t){console.error("Search error:",t)}finally{L(!1)}};l.useEffect(()=>{const s=setTimeout(()=>{Z(y)},300);return()=>clearTimeout(s)},[y]);const D=async s=>{var d,i;const[t,r]=s.center;(d=n.current)==null||d.flyTo({center:[t,r],zoom:17,duration:1e3}),(i=x.current)==null||i.setLngLat([t,r]);const a=v(s);a.postal_code&&a.postal_code.startsWith("48")?(m(a),c(null)):(c("Diese Adresse liegt auÃŸerhalb von MÃ¼nster"),m(null)),w(""),j([])},P=()=>{o&&b({street:o.street,house_number:o.house_number,postal_code:o.postal_code,city:o.city||"MÃ¼nster",lat:o.lat,lng:o.lng})};return e.jsxs("div",{className:"fixed inset-0 bg-black/70 flex flex-col",style:{zIndex:9999},children:[e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-b border-gray-200 flex-shrink-0",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"ðŸ“ Adresse wÃ¤hlen"}),e.jsx("button",{onClick:R,className:"w-10 h-10 flex items-center justify-center bg-gray-100 hover:bg-gray-200 rounded-full transition-colors",children:e.jsx(K,{size:20})})]}),e.jsxs("div",{className:"bg-white px-4 py-3 border-b border-gray-100 flex-shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Q,{size:20,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:y,onChange:s=>w(s.target.value),placeholder:"Adresse suchen...",className:"w-full pl-10 pr-4 py-3 bg-gray-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 text-base"}),I&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"w-5 h-5 border-2 border-rose-500/30 border-t-rose-500 rounded-full animate-spin"})})]}),k.length>0&&e.jsx("div",{className:"absolute left-4 right-4 mt-2 bg-white border border-gray-200 rounded-xl shadow-xl overflow-hidden",style:{zIndex:1e4},children:k.map((s,t)=>e.jsxs("button",{onClick:()=>D(s),className:"w-full flex items-start gap-3 p-3 hover:bg-rose-50 border-b border-gray-100 last:border-0 text-left active:bg-rose-100",children:[e.jsx(z,{size:18,className:"text-rose-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:s.text}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:s.place_name})]})]},s.id||t))})]}),e.jsxs("div",{className:"flex-1 relative min-h-0",children:[e.jsx("div",{ref:p,className:"absolute inset-0"}),!T&&e.jsx("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-10 h-10 border-3 border-rose-500/30 border-t-rose-500 rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Karte wird geladen..."})]})}),e.jsxs("button",{onClick:$,disabled:S,className:"absolute bottom-4 left-4 bg-white shadow-lg rounded-xl px-4 py-3 flex items-center gap-2 active:bg-gray-50 disabled:opacity-50",style:{zIndex:10},children:[e.jsx(U,{size:20,className:"text-rose-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Mein Standort"})]}),e.jsx("div",{className:"absolute bottom-4 right-4 bg-white/95 backdrop-blur-sm rounded-xl px-3 py-2 shadow-lg text-xs",style:{zIndex:10},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-rose-500/10 border-2 border-rose-500 border-dashed rounded"}),e.jsx("span",{className:"text-gray-700",children:"Liefergebiet"})]})}),S&&e.jsx("div",{className:"absolute inset-0 bg-white/60 flex items-center justify-center",style:{zIndex:20},children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-xl",children:[e.jsx("div",{className:"w-8 h-8 border-3 border-rose-500/30 border-t-rose-500 rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-3 text-sm",children:"Adresse wird gesucht..."})]})})]}),e.jsxs("div",{className:"bg-white border-t border-gray-200 p-4 flex-shrink-0 safe-bottom",children:[_&&e.jsxs("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded-xl flex items-start gap-2",children:[e.jsx(B,{size:18,className:"text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:_})]}),o?e.jsx("div",{className:"mb-3 p-3 bg-rose-50 border border-rose-200 rounded-xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-rose-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(z,{size:20,className:"text-rose-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:[o.street," ",o.house_number]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.postal_code," ",o.city]})]}),e.jsx(M,{size:22,className:"text-green-500 flex-shrink-0"})]})}):e.jsx("div",{className:"mb-3 p-3 bg-gray-50 border border-gray-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center",children:e.jsx(H,{size:20,className:"text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Tippe auf die Karte"}),e.jsx("p",{className:"text-xs text-gray-500",children:"oder suche eine Adresse"})]})]})}),e.jsxs("button",{onClick:P,disabled:!o,className:"w-full py-4 bg-rose-500 hover:bg-rose-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-bold rounded-2xl transition-colors flex items-center justify-center gap-2 text-base",children:[e.jsx(M,{size:20}),"Adresse Ã¼bernehmen"]})]})]})});export{J as default};
